<!DOCTYPE HTML>
    <html>
    <head>
    <title>SmartPlan</title>
    <link rel="stylesheet" href="jquery.mobile-1.0.1.css" />
    <script type="text/javascript" charset="utf-8" src="phonegap-1.4.1.js"></script>
    <script type="text/javascript" charset="utf-8" src="jquery-1.7.1.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/Global.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/Models.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/TaskCtrl.js"></script>
    <script>	
		$(document).bind("mobileinit", function(){
			$.mobile.fixedToolbars.setTouchToggleEnabled(false);
		    //$.mobile.touchOverflowEnabled = true;
		});
		
		$(document).ready(populateCalendarList);
		
		function populateCalendarList(){
			
			workslots = sorttasks(tasks,workhrs);
			
			now = new Date();
			currWeekday = -1;
			weekdays = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
			
			//$("<li data-role='list-divider'>"+now.toDateString()+"</li>").appendTo('#calendarlist');
			
			for(i=0;i<workslots.length;i++){
				if (workslots[i].workhr.day != currWeekday){
					currWeekday = workslots[i].workhr.day;
					$("<li data-role='list-divider'>"+workslots[i].datetime.toDateString()+"</li>").appendTo('#calendarlist');
				}
				
				for(j=0;j<workslots[i].tasks.length;j++){
					id = workslots[i].tasks[j].id;
					$("<li id='task-"+id+"'><a id='"+id+"' onclick='toggleEdit("+id+")'><h3>"+workslots[i].tasks[j].name+"</h3><p class='ui-li-aside'><strong>"+workslots[i].tasks[j].starttime.getHours()+":00</strong></p></a><a onclick='completeTask("+id+")'>Finish</a></li>").appendTo('#calendarlist');
					$("<li class='edit' id='edit-"+id+"' data-theme='e' style='display:none'><a rel='external' href='addtask.html?id="+id+"'>Edit</a></li>").appendTo('#calendarlist');
					$("<li class='edit' id='delete-"+id+"' data-theme='e' style='display:none'><a onclick='deleteTask("+id+',"'+workslots[i].tasks[j].name+'"'+")'>Delete</a></li>").appendTo('#calendarlist');
				}
			}
		}
		
		function toggleEdit(item){
			$('#edit-'+item).toggle();
			$('#delete-'+item).toggle();
		}
		
		function deleteTask(item,name){
			if (confirm("Are you sure you want to delete the task '"+name+"'? This action cannot be undone.")) { 
				alert('Task '+item+' DELEEEETEEEEDDD!!');
				
				//delete. For now just taking out from screen
				$('#task-'+item).remove();
				$('#edit-'+item).remove();
				$('#delete-'+item).remove();
				
				//after deleting, refresh page
			}
		}
		
		function completeTask(item){
			alert('Complete task '+item);
		}
	</script>
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <script type="text/javascript" charset="utf-8" src="jquery.mobile-1.0.1.min.js"></script>
    </head>
    <body>
		<div data-role="page" id="index-calendar"> 
			<div data-role="header" data-position="inline">
				<a href="settings.html" data-icon="gear" rel="external">Settings</a>
				<h1>Calendar</h1>
				<a href="addtask.html" data-icon="plus" data-iconpos="right" rel="external">Add</a>
			</div>
			<div data-role="content">
				<ul data-role="listview" id="calendarlist" data-split-icon="checkbox-off" data-split-theme="d">
				<li><a href="welcome.html" rel="external" data-theme='b'>Welcome Screen (Link won't exist in final version)</a></li>
				</ul>				
			</div>
			<div data-role="navbar">
				<ul>
					<li><a href="">List</a></li>
					<li><a href="" class="ui-btn-active">Day</a></li>
				</ul>
			</div>
		</div>
    </body>
    </html>